{% extends "base.html"%}
{% load static %}

{% block title %}
Place {{place}}
{% endblock %}

{% block bar %}
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#navbar-content">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#/">
                <span><img class="logo-sm" src='{% static "img/domotinaLogo.png" %}'/></span> Domotina
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-content">
            <ul class="nav navbar-nav">
                <li><a href='{% url "map_home" %}'>Places</a></li>
                <li><a href>Alarms</a></li>
                <li><a href>Events</a></li>
            </ul>
            {% block toggle_login %}
            {% include "login.html" %}
            {% endblock %}
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
{% endblock %}

{% block content %}
<div class="col-md-8">
    <div class="col-md-12">
        <div style='background-image:url("{{ map_url }}");' class="map">
            <canvas id="place_canvas" width="700" height="400">
                Your browser does not support the HTML5 canvas tag.
            </canvas>
            <script>
                var sensors = [{{sensors | safe}}];
                function showIcons() {
                    var c = document.getElementById("place_canvas");
                    var ctx = c.getContext("2d");
                    var currentSensor;
                    for (var i in sensors) {
                        currentSensor = new Image();
                        currentSensor.src = sensors[i].url;
                        ctx.drawImage(currentSensor, sensors[i].pos_x, sensors[i].pos_y);
                    }
                }
                $(document).ready(showIcons);
                $(window).load(showIcons);

            </script>
        </div>
    </div>
    <div class="col-md-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">EVENTS</h3>
            </div>
            <ul class="list-group">
                {% for event in events %}
                <li class="list-group-item">{{event.timestamp}} - {{event.sensor}} reported {{event.type}}</li>
                {% empty %}
                <li class="list-group-item">There are no events in this place</li>
                {% endfor %}
            </ul>
        </div>
        <nav>
            <ul class="pager">
                {% if events.has_previous %}
                    <li class="previous"><a href="?page={{ events.previous_page_number }}">previous</a></li>
                {% else %}
                    <li class="previous disabled"><a href>previous</a></li>
                {% endif %}

                <span class="current">
                    Page {{ events.number }} of {{ events.paginator.num_pages }}
                </span>

                {% if events.has_next %}
                    <li class="next"><a href="?page={{ events.next_page_number }}">next</a></li>
                {% else %}
                    <li class="next disabled"><a href>next</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
<div class="col-md-4">
    <div class="panel panel-warning">
        <div class="panel-heading">
            <h3 class="panel-title">ALARMS</h3>
        </div>
        <ul class="list-group">
            {% for alarm in alarms %}
            <li class="list-group-item">{{alarm.activation_date}} - Alarm generated from {{alarm.event.type}} on
                {{alarm.event.sensor}}
            </li>
            {% empty %}
            <li class="list-group-item">There are no alarms in this place</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}